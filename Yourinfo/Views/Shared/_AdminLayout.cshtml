@inject IHtmlHelper HtmlHelper
@{
    var username = Context.Session.GetString("Username");
}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Index Page</title>
    <link rel="stylesheet" href="~/admin/assets/css/backend-plugin.min.css">
    <link rel="stylesheet" href="~/admin/assets/css/backend-plugin.min.css">
    <link rel="stylesheet" href="~/admin/assets/css/backend.css?v=1.0.0">
    <link rel="stylesheet" href="~/admin/assets/vendor/fortawesome/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="~/admin/assets/vendor/line-awesome/dist/line-awesome/css/line-awesome.min.css">
    <link rel="stylesheet" href="~/admin/assets/vendor/remixicon/fonts/remixicon.css">
    
</head>
<body class="  ">
    <!-- loader Start -->
    <div id="loading">
        <div id="loading-center">
        </div>
    </div>
    <!-- loader END -->
    <!-- Wrapper Start -->
    <div class="wrapper">

        <div class="iq-sidebar  sidebar-default ">
            <div class="iq-sidebar-logo d-flex align-items-center justify-content-between">
                @if (User.Identity.IsAuthenticated)
                {
                    if (User.IsInRole("Admin"))
                    {
                        <a href="@Url.Action("Index","Admin")" class="header-logo">
                            <img src="~/admin/assets/images/logo.png" class="img-fluid rounded-normal light-logo" alt="logo"><h5 class="logo-title light-logo ml-3">YoursInfo</h5>
                        </a>
                    }
                    else if (User.IsInRole("Customer"))
                    {
                        <a href="@Url.Action("Index","Customer")" class="header-logo">
                            <img src="~/admin/assets/images/logo.png" class="img-fluid rounded-normal light-logo" alt="logo"><h5 class="logo-title light-logo ml-3">YoursInfo</h5>
                        </a>
                    }
                }


                <div class="iq-menu-bt-sidebar ml-0">
                    <i class="las la-bars wrapper-menu"></i>
                </div>
            </div>
            <div class="data-scrollbar" data-scroll="1">
                @if (User.Identity.IsAuthenticated)
                {
                    if (User.IsInRole("Admin"))
                    {
                        <nav class="iq-sidebar-menu">
                            <ul id="iq-sidebar-toggle" class="iq-menu">
                                <li class=" ">
                                    <a href="@Url.Action("Index","Admin")" class="svg-icon">
                                        <svg class="svg-icon" id="p-dash1" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                        </svg>
                                        <span class="ml-4">Dashboards</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>

                    }
                    else if (User.IsInRole("Customer"))
                    {
                        <nav class="iq-sidebar-menu">
                            <ul id="iq-sidebar-toggle" class="iq-menu">
                                <li class=" ">
                                    <a href="@Url.Action("Index","Customer")" class="svg-icon">
                                        <svg class="svg-icon" id="p-dash1" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                        </svg>
                                        <span class="ml-4">Dashboards</span>
                                    </a>
                                </li>
                                <li class=" ">
                                    <a href="@Url.Action("GetGalleryImages","Customer")" class="svg-icon">
                                        <svg class="svg-icon" id="p-dash1" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                        </svg>
                                        <span class="ml-4">Customize Gallery Images</span>
                                    </a>
                                </li>
                                <li class=" ">
                                    <a href="@Url.Action("GetBrochure","Customer")" class="svg-icon">
                                        <svg class="svg-icon" id="p-dash1" width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                        </svg>
                                        <span class="ml-4">Customize Teams Images</span>
                                    </a>
                                </li>

                            </ul>
                        </nav>
                    }
                }
                <div class="p-3"></div>
            </div>
        </div>
        <div class="iq-top-navbar">
            <div class="iq-navbar-custom">
                <nav class="navbar navbar-expand-lg navbar-light p-0">
                    <div class="iq-navbar-logo d-flex align-items-center justify-content-between">
                        @if (User.Identity.IsAuthenticated)
                        {
                            if (User.IsInRole("Admin"))
                            {
                                <i class="ri-menu-line wrapper-menu"></i>
                                <a href="@Url.Action("Index","Admin")" class="header-logo">
                                    <img src="~/admin/assets/images/logo.png" class="img-fluid rounded-normal" alt="logo">
                                    <h5 class="logo-title ml-3">Yours-Info</h5>

                                </a>
                            }
                            else if (User.IsInRole("Customer"))
                            {
                                <i class="ri-menu-line wrapper-menu"></i>
                                <a href="@Url.Action("Index","Customer")" class="header-logo">
                                    <img src="~/admin/assets/images/logo.png" class="img-fluid rounded-normal" alt="logo">
                                    <h5 class="logo-title ml-3">Yours-Info</h5>

                                </a>
                            }
                        }


                    </div>
                    <div class="iq-search-bar device-search">
                    </div>
                    <div class="d-flex align-items-center">
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                                data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                                aria-label="Toggle navigation">
                            <i class="ri-menu-3-line"></i>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav ml-auto navbar-list align-items-center">
                                <li class="nav-item nav-icon dropdown caption-content">
                                    <a href="#" class="search-toggle dropdown-toggle" id="dropdownMenuButton4"
                                       data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <img src="~/admin/assets/images/user/1.png" class="img-fluid rounded" alt="user">
                                    </a>
                                    <div class="iq-sub-dropdown dropdown-menu" aria-labelledby="dropdownMenuButton">
                                        <div class="card shadow-none m-0">
                                            <div class="card-body p-0 text-center">
                                                <div class="media-body profile-detail text-center">
                                                    <img src="~/admin/assets/images/page-img/profile-bg.png" alt="profile-bg"
                                                         class="rounded-top img-fluid mb-2">
                                                </div>
                                                <div class="p-3">

                                                    @if (User.Identity.IsAuthenticated)
                                                    {
                                                        <h5 class="mb-1">Welcome, @Context.Session.GetString("Username")!</h5>
                                                        <p class="mb-0">Login Time: @Context.Session.GetString("LoginTime")</p>
                                                        <div class="d-flex align-items-center justify-content-center mt-3">
                                                            <form asp-controller="Account" asp-action="Logout" method="post" id="logoutForm">
                                                                @Html.AntiForgeryToken()
                                                                <button type="submit" class="nav-link btn border btn-link text-dark">Logout</button>
                                                            </form>

                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <script>
                                                            window.location.href = '@Url.Action("Login", "Account")';
                                                        </script>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
        </div>

        <div class="content-page">
            <div class="container-fluid">
                <div class="row">
                    @RenderBody()
                </div>
                <!-- Page end  -->
            </div>
        </div>
    </div>
    <!-- Wrapper End-->
    <footer class="iq-footer">
        <div class="container-fluid">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-6">
                            <ul class="list-inline mb-0">
                                <li class="list-inline-item"><a href="~/admin/backend/privacy-policy.html">Privacy Policy</a></li>
                                <li class="list-inline-item"><a href="~/admin/backend/terms-of-service.html">Terms of Use</a></li>
                            </ul>
                        </div>
                        <div class="col-lg-6 text-right">
                            <span class="mr-1"><script>document.write(new Date().getFullYear())</script>©</span> <a href="#" class="">Yours Info</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </footer>

    <!-- Backend Bundle JavaScript -->
    <script src="~/admin/assets/js/backend-bundle.min.js"></script>

    <!-- Table Treeview JavaScript -->
    <script src="~/admin/assets/js/table-treeview.js"></script>

    <!-- Chart Custom JavaScript -->
    <script src="~/admin/assets/js/customizer.js"></script>

    <!-- Chart Custom JavaScript -->
    <script async src="~/admin/assets/js/chart-custom.js"></script>

    <!-- app JavaScript -->
    <script src="~/admin/assets/js/app.js"></script>

    <script>
        let idleTimeout;
        const idleDuration = 30 * 60 * 1000; // 30 minutes in milliseconds


        // Function to redirect the user after timeout
        function redirectAfterTimeout() {
            const token = document.querySelector('input[name="__RequestVerificationToken"]').value;

            fetch('/Account/Logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'RequestVerificationToken': token
                },
                credentials: 'include' // Include cookies with the request
            })
                .then(response => {
                    if (response.ok) {
                        window.location.href = '/Account/Login'; // Redirect to login page
                    } else {
                        console.error('Logout failed.');
                    }
                })
                .catch(error => console.error('Error:', error));
        }


        // Function to reset the idle timer
        function resetIdleTimer() {
            clearTimeout(idleTimeout); // Clear the existing timeout
            idleTimeout = setTimeout(redirectAfterTimeout, idleDuration); // Set a new timeout
        }

        // Event listeners for user activity
        function setupEventListeners() {
            document.onmousemove = resetIdleTimer; // Reset timer on mouse movement
            document.onkeypress = resetIdleTimer; // Reset timer on key press
            document.ontouchstart = resetIdleTimer; // Reset timer on touch events
            document.addEventListener('visibilitychange', function () {
                if (document.visibilityState === 'visible') {
                    resetIdleTimer(); // Reset timer when the page becomes visible
                }
            });
        }

        // Initialize the idle timer and event listeners
        function initializeIdleTimer() {
            ;
            setupEventListeners(); // Set up event listeners
            resetIdleTimer(); // Start the timer
        }

        window.onload = initializeIdleTimer; // Start everything when the page loads

        // window.close = redirectAfterTimeout();

       // window.addEventListener('beforeunload', redirectAfterTimeout());
    </script>
    @RenderSection("Scripts", required: false)
</body>
</html>